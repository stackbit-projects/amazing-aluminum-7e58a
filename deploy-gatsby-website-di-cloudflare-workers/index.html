<!doctype html>
<html lang="en">
    <head>    

        <title>Deploy Gatsby Website di Cloudflare Workers - Stackbit Ampersand Theme</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="<p>Kali ini ingin membahas tentang framwork gatsbyJS dan Cloudflare Workers, sudah hampir satu bulan lebih menunggu cloudflare pages resmi realese namun sudah daftar beta request belum dapat saja aksesnya.</p>

"/>
        <link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700%7CRoboto:400,400i,700,700i&display=swap" rel="stylesheet"> 
        <link rel="stylesheet" href="/assets/css/main.css">
         
        
        
        
        
        
        
    </head>
    <body>
        
          <div id="page" class="site layout-grid palette-green">

    <header id="masthead" class="site-header outer">
  <div class="inner">
    <div class="site-header-inside">

      <div class="site-branding">
        
        
        <p class="site-logo">
          <a href='/'><img src="/images/logo.svg"
            alt="Ampersand Logo" /></a>
        </p>
        
        
        <p class="site-title"><a href='/'>Ampersand</a></p>
        
      </div><!-- .site-branding -->

      
      
      <button id="menu-open" class="menu-toggle"><span class="screen-reader-text">Menu</span><span class="icon-menu"
        aria-hidden="true"></span></button>
      <nav id="main-navigation" class="site-nav" aria-label="Main Navigation">
        <div class="site-nav-inside">
          <button id="menu-close" class="menu-toggle"><span class="screen-reader-text">Menu</span><span class="icon-close"
              aria-hidden="true"></span></button>
          <ul class="menu">
            
              
              
              <li class="menu-item">
                
                
<a href="/"
  
  
  class="">
  
    Home
  
</a>

              </li>
            
              
              
              <li class="menu-item">
                
                
<a href="/about"
  
  
  class="">
  
    About
  
</a>

              </li>
            
              
              
              <li class="menu-item">
                
                
<a href="/style-guide"
  
  
  class="">
  
    Style Guide
  
</a>

              </li>
            
              
              
              <li class="menu-item">
                
                
<a href="/contact"
  
  
  class="">
  
    Contact
  
</a>

              </li>
            
          </ul><!-- .menu -->
        </div><!-- .site-nav-inside -->
      </nav><!-- .site-navigation -->
      

    </div><!-- .site-header-inside -->
  </div><!-- .inner -->
</header><!-- .site-header -->


    <div id="content" class="site-content outer">
      <main id="main" class="site-main inner">

          <article class="post post-full">
    <header class="post-header inner-md">
      <div class="post-meta">
        <time class="published"
          datetime="2021-01-30 17:35">Saturday, January 30, 2021</time>
      </div>
      <h1 class="post-title">Deploy Gatsby Website di Cloudflare Workers</h1>
      
      
    </header><!-- .post-header -->
    
    
    <div class="post-content inner-md">
      <p>Kali ini ingin membahas tentang framwork gatsbyJS dan Cloudflare Workers, sudah hampir satu bulan lebih menunggu cloudflare pages resmi realese namun sudah daftar beta request belum dapat saja aksesnya.</p>

<p>Akhirnya masih setia dengan workers-nya, sudah tidak perlu dijelaskan lagi apa itu cloudflare workers sudah pernah dibahas juga di blog ini, salah satu framework yang keren menurut saya adalah gasbyjs.</p>

<h2 id="build-gatsby-dengan-github-action">Build Gatsby dengan Github Action</h2>

<p>Pertama sebelum mendeploy gatsby website kalian di cloudflare workers sebelumnya harus mem-build di komputer lokal kalian dengan perintah <em>“gatsby build”</em> atau dengan wrangler namun disini saya lebih memilih menggunakan github action untuk build gatsby webiste.</p>

<p>Salah satu alasanya kalo deploy secara lokal di komputer itu membutuhkan waktu lama kalo build gatsby karena laptop saya yang butut wkkwkw, harus ganti ke mekbuk m1 keknya.</p>

<p>Pertama siapkan repostory github kalian lalu masuk ke pilihan github action, dan masukan baris gatsby publish di workflows, seperti ini.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: Gatsby Publish

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: enriikke/gatsby-gh-pages-action@v2
        with:
          access-token: $
          deploy-branch: www
          gatsby-args: --prefix-paths
</code></pre></div></div>

<p>Sesuaikan branch yang ingin di build gasby webiste kalian, defaultnya master atau main, lalu pilih deploy-branch sebagai output dari hasil buildnya, disini saya menggunakan nama branch www sebagai hasil deploy.</p>

<p>Namun sebelumnya memerlukan akses token github kalian, cara mendapatkan akses token github kalian bisa membuat di pengaturan profil lalu pilih developer setiing, jika sudah berhasil dibuat simpan baik-baik.</p>

<p>Selanjutnya simpan akses token tersebut di pengaturan repo lalu pilih secret seperti ini.</p>

<p><img src="https://i0.wp.com/wildanfauzy.com/img/token.png" alt="" />Jika sudah lakukan push ke repostory untuk mentriger github-action yang sudah dibuat lalu tunggu beberapa detik sampai gatsby website kalian berhasil dibuat dan mendapatkan branch baru dengan hasil dari output tadi seperti ini.</p>

<p><img src="https://i0.wp.com/wildanfauzy.com/img/gatsby.png" alt="" />Selamat website dengan framework gatsby kalian berhasil dibuat, selanjutnya kalian bisa menggunakan dengan github pages atau yang lainnya, namun karena disini saya ingin menggunakan cloudflare workers.</p>

<h2 id="deploy-gatsby-website-ke-workers">Deploy gatsby website ke workers</h2>

<p>Selanjutnya mendeploy gatsby website ke cloudflare workers dengan github action, hal yang perlu diperhatikan kalian harus membuat api token cloudflare workers, bisa dibuat di profil cloudflare lalu pilih api token dan sesuaikan dengan akses ke workers, seperti ini.</p>

<p><img src="https://i0.wp.com/wildanfauzy.com/img/api-workers.png" alt="" />Pilih template “edit cloudflare workers” setelah berhasil membuat api cloudflare workers, simpan api token itu dengan baik-baik jangan sampai lupa, selanjutnya menyimpan api token tersebut di secret repostrory kalian.</p>

<p>Jika sudah menyimpan api token, sebelumnya membuat pengaturan wrangler.toml sesuai dengan info akun cloudflare kalian, seperti zona id dan account id, bisa kalian dapatkan di dashboard cloudflare, konfigurasi wrangler.toml seperti ini.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name = "warkop"
type = "javascript"
account_id = "AKUN ID CLOUDFLARE KALIAN"
workers_dev = true

[env.production]
workers_dev = false
route = "https://www.aep.my.id/*"
zone_id = "ZONE ID CLOUDFLARE KALIAN"

[site]
bucket = "./"
entry-point = "workers-site"
</code></pre></div></div>

<p>Simpan konfigurasi wrangler.toml tersebut di branch dimana hasil output gatsby website, disini saya menyimpan di branch www, selanjutnya menjalankan github action untuk mendeploy ke cloudflare workers, seperti ini.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: Deploy

on:
  push:
    branches:
      - www
jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy
    steps:
      - uses: actions/checkout@master
      - name: Publish
        uses: cloudflare/wrangler-action@1.2.0
        env:
          USER: root
        with:
          apiToken: $
</code></pre></div></div>

<p>Simpan pengaturan github-action itu sesuka kalian bisa di master atau branch hasil output build gatsby, dengan membuat workflows di folder “.github/workflows/cloudflare-workers.yml” lalu tunggu beberapa detik sampai proses deploy ke workers selesai.</p>

<p><img src="https://i0.wp.com/wildanfauzy.com/img/worker.png" alt="" />Jika berhasil selamat gatsby website kalian berhasil diupload ke workers, maka akan menghasilkan alamat webite dengan nama projek yang kalian buat dengan subdomain workers.dev, seperti disini hasil workers websitenya menghasilkan alamat warkop.aku.workers.dev seperti itu.</p>

<h2 id="route-website-workers-ke-alamat-domain">Route website workers ke alamat domain</h2>

<p>Setelah berhasil mendeploy, kalian mendapatkan alamat website dengan subdomain workers.dev namun rasanya kurang gitu, lalu bagaimana menghubungkan ke domain kalian?</p>

<p>Petama masuk ke dashboard cloudflare lalu klik tab workes, selanjutnya add route untuk mengbungkan ke alamat domain kalian.</p>

<p><img src="https://i0.wp.com/wildanfauzy.com/img/route.png" alt="" /></p>

<p>Seperti gambar diatas, sambungkan alamat domain dengan workers yang sudah kalian buat, perlu diingat awan orange di dns harus diaktifkan agar workers berjalan.</p>

<p>Sudah deh jadi,</p>

<ul>
  <li>Repostory projek: <a href="https://github.com/wilfauzy/Warkop" title="https://github.com/wilfauzy/Warkop">https://github.com/wilfauzy/Warkop</a></li>
  <li>
    <p>Tema Gatsby: <a href="https://www.gatsbyjs.com/starters/ajayns/gatsby-absurd" title="theme gatsby absurd">Gatsby Absurd</a></p>
  </li>
  <li>
    <p>Alamat website projek: <a href="https://www.aep.my.id/" title="https://www.aep.my.id/">https://www.aep.my.id/</a></p>
  </li>
  <li>Workers website: <a href="https://warkop.aku.workers.dev/" title="https://warkop.aku.workers.dev/">https://warkop.aku.workers.dev/</a></li>
</ul>

    </div><!-- .post-content -->
  </article><!-- .post -->

  <!-- Next/previous post navigation TBD -->
  <!--
  <nav class="post-navigation">
    <h2 class="post-nav-title">Read Next</h2>
    <div class="post-feed">
      <article class="post post-card">
        <div class="post-card-inside">
          <a class="post-card-thumbnail" href="#">
            <img class="thumbnail" src="#" alt="" />
          </a>
          <div class="post-card-content">
            <header class="post-header">
              <div class="post-meta">
                <time class="published" datetime="">Previous post date</time>
              </div>
              <h3 class="post-title"><a href="#" rel="bookmark">Previous Post Title</a></h3>
            </header>
            <div class="post-excerpt">
              <p>Previous post excerpt</p>
              <p class="read-more">
                <a class="button button-secondary" href="#">Read more</a>
              </p>
            </div>
          </div>
        </div>
      </article>
      <article class="post post-card">
        <div class="post-card-inside">
          <a class="post-card-thumbnail" href="#">
            <img class="thumbnail" src="#" alt="" />
          </a>
          <div class="post-card-content">
            <header class="post-header">
              <div class="post-meta">
                <time class="published" datetime="">Next post date</time>
              </div>
              <h3 class="post-title"><a href="#" rel="bookmark">Next Post Title</a></h3>
            </header>
            <div class="post-excerpt">
              <p>Next post excerpt</p>
              <p class="read-more">
                <a class="button button-secondary" href="#">Read more</a>
              </p>
            </div>
          </div>
        </div>
      </article>
    </div>
  </nav>
  -->


      </main><!-- .site-main -->
    </div><!-- .site-content -->

    
    
      <section class="subscribe outer">
  <div class="inner-sm">
    
    
    <h2 class="subscribe-title">Subscribe for new updates</h2>
    
    
    
    <p class="subscribe-text">
      Subscribe to my email newsletter to receive useful articles and special offers. This monthly email is sent out on the first of every month.
    </p>
    
    <form name="subscribeForm" action="/subscribe-success" method="POST" data-netlify-honeypot="bot-field" data-netlify="true" class="subscribe-form">
  <div class="screen-reader-text">
    <label>Don't fill this out if you're human: <input name="bot-field" /></label>
  </div>
  <div class="form-group">
    <label>
      <span class="screen-reader-text">Email address</span>
      <input type="email" name="email" placeholder="Your email address" required>
    </label>
  </div>
  <input type="hidden" name="form-name" value="subscribeForm" />
  <button class="button" type="submit">Subscribe</button>
</form><!-- .subscribe-form -->

  </div><!-- inner-sm -->
</section><!-- .subscribe -->

    

    <footer id="colophon" class="site-footer outer">
  <div class="inner">
    <div class="site-footer-inside">
      <div class="site-info">
        
        
        <span class="copyright">&copy; Stackbit. All rights reserved. This Jamstack site was created with <a href="https://www.stackbit.com/?utm_source=deployed-footer" target="_blank" rel="noopener">Stackbit</a>. Create yours <a href="https://app.stackbit.com/create?theme=ampersand&utm_source=deployed-footer" target="_blank" rel="noopener">now</a>.</span>
        
        
      </div><!-- .site-info -->
      
      
      <div class="social-links">
        
          
          
<a href="https://twitter.com/"
   target="_blank"
   rel="noopener "
  class="button button-icon">
  
    <span class="icon fab fa-twitter" aria-hidden="true"></span><span class="screen-reader-text">Twitter</span>
  
</a>

        
          
          
<a href="https://www.instagram.com/"
   target="_blank"
   rel="noopener "
  class="button button-icon">
  
    <span class="icon fab fa-instagram" aria-hidden="true"></span><span class="screen-reader-text">Instagram</span>
  
</a>

        
          
          
<a href="https://github.com/"
   target="_blank"
   rel="noopener "
  class="button button-icon">
  
    <span class="icon fab fa-github" aria-hidden="true"></span><span class="screen-reader-text">GitHub</span>
  
</a>

        
          
          
<a href="https://www.linkedin.com/"
   target="_blank"
   rel="noopener "
  class="button button-icon">
  
    <span class="icon fab fa-linkedin" aria-hidden="true"></span><span class="screen-reader-text">LinkedIn</span>
  
</a>

        
          
          
<a href="https://dev.to/"
   target="_blank"
   rel="noopener "
  class="button button-icon">
  
    <span class="icon fab fa-dev" aria-hidden="true"></span><span class="screen-reader-text">DEV</span>
  
</a>

        
      </div><!-- .social-links -->
      
    </div><!-- .site-footer-inside -->
  </div><!-- .inner -->
</footer><!-- .site-footer -->


  </div><!-- .site -->

        <!-- Scripts -->
        <script src="/assets/js/plugins.js"></script>
        <script src="/assets/js/main.js"></script>
    </body> 
</html>
